## Stateless, Stateful 빈

- 오늘 면접 중에 유일하게 답변 하지 못한 질문인데 추후 답변을 위해 정리해 본다.

- 질문은 이랬다. "스프링의 싱글턴 빈이 Stateful 하면 어떤 문제가 있을까요?"

- Stateful? 상태가 꽉차있다? 필드에 값을 가지고 있다는 말인가? 그럼 값이 고정되어 있다는 뜻? 바로 자유롭지 못하다는 생각이 들었고 나는 Stateful 한 빈은 강한 결속력을 가지고 있다. 핵심 비즈니스 로직으로 사용되는 경우, (애매 모호하게) 인터페이스처럼 다형성 확보가 되지 못한다. 라고 대답했다.

- 틀린 말은 아니라고 하셨지만, 주된 이유는 Thread-Safe 하지 못하다는 답변이셨다. 내가 제대로 못한 이유는 분명할 것이다.

- **내가 스프링 Bean에서의 Stateful, Stateless 하다는 말을 이해를 못한것이다. 대체 뭘까?**

- 그래서 "싱글톤 방식" 에서 주의할점 에 대해서 검색해 봤더니 다음과 같은 답을 찾을 수 있었다.

  - **싱글톤 방식은 무상태(stateless)로 설계해야 한다**

    - 특정 클라이언트에 의존적인 필드가 있으면 안된다. <br>

    - 특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안된다. <br>

    - 가급적 읽기만 가능해야 한다. <br>

    - 필드 대신에 자바에서 공유되지 않는, 지역변수, 파라미터, ThreadLocal 등을 사용해야 한다.

- 그렇다 이유는 간단했다. 싱글톤 방식으로 빈이 생성된다는 것은 공유되는 객체라는 뜻인데, 공유되는 객체가 변경되는 값이 있으면 되겠는가? 쓰레드가 동시 접근하는데 빈이 들고 있는 어떤 값이 계속적으로 변경된다면(Stateful), 같은 요청이라도 다른결과가 발생할 수 있다는 것이다.

- 의존성을 가지고있는 필드가 있으면 안된다는 말에서 내가 한 주장이 틀린 말은 아니지만 핵심적인 이유에는 멀티 쓰레드가 무조건 같은 객체를 쓰게해야한다는 말이었다. (Thread-Safe)

- **스프링 빈을 싱글턴 빈으로 만드는 주된 이유는 Thread-Safe 를 유지하기 위한 것이었다.**

- 다음엔... 제대로 대답해야지 ㅠㅠ
