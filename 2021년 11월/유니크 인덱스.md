## 유니크 인덱스

- 유니크는 사실 인덱스가릭보다는 제약 조건에 가깝다고 볼 수 있다.

  

- 말 그대로 테이블이나 인덱스에 같은 값이 2개 이상 저장될 수 없음을 의미하는데, __MySQL에서는 인덱스 없이 유니크 제약만 설정할 방법이 없다.__

  

- __유니크 인덱스에서 NULL 도 저장될 수 있는데, 특정 NULL은 특정 값이 아니므로 2개 이상 저장될 수 있다.__

  

- MySQL에서 PK는 기본적으로 NULL을 허용하지 않는 유니크 속성이 자동으로 부여된다.

  

- MyISAM이나 MEMORY 테이블에서 PK는 사실 NUL이 허용되지 않는 유니크 인덱스와 같지만, InnoDB 테이블의 PK는 클러스터링 키의 역할도 하므로 유니크 인덱스와는 근본적으로 다르다.



<br>

***

## 유니크 인덱스와 일반 세컨더리 인덱스의 비교

- 유니크 인덱스와 유니크하지 않은 일반 세컨더리 인덱스는 사실 인덱스의 구조상 아무런 차이점이 없다.

  

- 유니크 인덱스와 일반 세컨더리 인덱스의 읽기와 쓰기를 성능 관점에서 한번 살펴보자.



<br>



### 인덱스 읽기

- 많은 사람이 유니크 인덱스가 빠르다고 생각하지만 이것은 사실이 아니다.

  - 유니크 인덱스는 1건만 읽으면 되지만, 유니크하지 않은 세컨더리 인덱스는 레코드를 한건 더 읽어야하므로 느리다고 이야기 한다.

    

- 유니크하지 않은 세컨더리 인덱스에서 한 번 더 해야 하는 작업은 디스크 읽기가 아니라 CPU에서 컬럼값을 비교하는 작업이기 때문에, 이는 성능상 영향이 거의 없다고 볼 수 있다.

  

- 유니크하지 않은 세컨더리 인덱스는 중복된 값이 허용되므로, __읽어야 할 레코드가 많아 느린 것이지 인덱스 자체의 특성 때문에 느린 것이 아니라는 것이다.__

  

- 하나의 값을 검색하는 경우, 유니크 인덱스와 일반 세컨더리 인덱스는 사용되는 실행 계획이 다르다.

  - 하지만 이는 인덱스의 성격이 유니크한지 아닌지에 따른 차이일 뿐 큰 차이는 없다.

    

  - __1개의 레코드를 읽느냐, 2개 이상의 레코드를 읽느냐의 차이만 있다는 것을 의미할 뿐, 읽어야할 레코드 건수가 같다면 성능상 차이는 없다.__

    

<br>



### 인덱스 쓰기

- 새로운 레코드가 INSERT 되거나 인덱스 컬럼의 값이 변경되는 경우에는 인덱스 쓰기 작업이 필요하다.

  

- 그런데 유니크 인덱스의 키 값을 쓸 때는 중복된 값이 있는지 없는지 체크하는 과정이 한 단계 더필요하다.

  - 그래서 유니크하지 않은 세컨더리 인덱스의 쓰기보다 느리다.

  

- 그런데 MySQL에서는 유니크 인덱스에서 중복된 값을 체크할 때는 읽기 잠금을 사용하고, 쓰기를 할 때는 쓰기 잠금을 사용하는데 이 과정에서 데드락이 아주 빈번히 발생한다.

  

- 또한 InnoDB 스토리지 엔진에는 인덱스 키의 저장을 버퍼링하기 위해 체인지 버퍼(Change Buffer)가 사용된다.

  

- 인덱스의 저장이나 변경 작업이 상당히 빨리 처리되지만, __안타깝게도 유니크 인덱스는 반드시 중복 체크를 해야 하므로 작업 자체를 버퍼링하지 못한다.__

  - __유니크 인덱스는 일반 세컨더리 인덱스보다 변경 작업이 더 느리게 작동한다.__



<br>



### 유니크 인덱스 사용 시 주의사항

- 꼭 필요한 경우라면 유니크 인덱스를 생성하는 것은 당연하다.

  

- 하지만 더 성능이 좋아질 것으로 생각하고 불필요하게 유니크 인덱스를 생성하지는 않는 것이 좋다.

  

- __하나의 테이블에서 같은 컬럼에 유니크 인덱스와 일반 인덱스를 가각 중복해서 생성해 둔 경우가 가끔 있는데, MySQL의 유니크 인덱스느 ㄴ일반 다른 인덱스와 같은 역할을 하므로 중복해서 인덱스를 생성할 필요는 없다.__

  

- __가끔 똑같은 컬럼에 PK와 유니크 인덱스를 동일하게 생성한 경우도 있는데, 이 또한 불필요한 중복이므로 주의하자.__

  

- 유니크 인덱스는 쿼리의 실행 계획이나 테이블의 파티션에 미치는 영향이 있다.

  

- 결론적으로 유일성이 꼭 보장되어야 하는 컬럼에 대해서는 유니크 인덱스를 생성하되, 꼭 필요하지 않다면 유니크 인덱스보다는 유니크하지 않은 세컨더리 인덱스를 생성하는 방법도 한 번씩 고려해 보자.