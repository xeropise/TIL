# 세션 대신 토큰 기반 인증을 사용하는 이유?

## 세션 기반 인증

- 서버 측에서 클라이언트의 정보를 기억하고 있다가, 사용자의 로그인 요청을 하는 경우, 사용자 확인 후, 들어오는 요청이 같은 사용자임을 유지하기 위해 세션을 사용하는 것

  ![다운로드](https://user-images.githubusercontent.com/50399804/123538367-91a84d80-d76f-11eb-9993-aec9ecaa6c35.png)

- 세션 기반 인증은 다음과 같은 장단점이 있다.

- 장점

  - 서버측에서 인증정보를 관리하는 것이기 때문에 클라이언트에 의한 정보 변조나 데이터 손실 우려가 없다.

  - 클라이언트 별 고유한 세션 ID 값을 발급 받으므로, 일일히 회원 정보를 확인하지 않아도 된다.

- 단점

  - 세션 하이재킹 공격으로 쿠키가 탈취당할 경우, 보내지 말아야 할 정보를 보낼 수도 있다. 이를 방지 하기 위해 탈취된 정보를 암호화하거나 여러 가지 방지책을 설정해야 한다.

  - 서버에서 세션 데이터를 저장하고 있으므로 (서버 인메모리 혹은 데이터베이스), StateFul 서버가 된다.

  - 클라이언트가 늘어나게 되면 많은 트래픽을 감당하기 위해 여러 서버를 추가해야할 뿐만 아니라 이를 위해 세션 클러스터링 등의 세션 분산 시스템을 설계해야 하는데 쉽지 않다.

  - 쿠키가 단일 도메인 및 서브 도메인에만 작동하도록 설계되어 있기 때문에 여러 도메인에서 관리하기 어렵다.

---

<br>
<br>

## 토큰 기반 인증

- 로그인 요청을 한 사용자들에게 토큰을 발급하고, 서버에 요청을 할 때 Header 에 토큰을 함께 보내어, 사용자가 인증된 사용자인지 검사하는 방법

  ![다운로드 (1)](https://user-images.githubusercontent.com/50399804/123538746-3ecf9580-d771-11eb-9460-50b60d72352c.png)

- 사용자의 정보를 세션에 유지하지 않고 클라이언트 측에서 들어오는 요청만으로 작업을 처리하므로 Stateless 한 서버가 된다.

- 다음과 같은 장단점이 있다.

  - 장점

    - 클라이언트 측에 토큰 정보가 있으므로 서버에 부담이 없어 서버의 확장성에 큰 장점이 있다. 어떠한 서버로 요청이 들어와도 토큰이 유효한지만 확인하면 된다.

    - 클라이언트가 쿠키를 사용하지 않으므로, 쿠키 사용에 의한 취약점, 예로 CSRF를 방지할 수 있다. 하지만, 토큰 사용도 취약점이 없는건 아니다.

    - 멀티 디바이스 환경에서 로그인 할 경우를 크게 고려하지 않아도 된다.(CORS) 어디서든지 사용 가능하다.

  - 단점

    - 토큰 사용도 취약점이 없는 것은 아니다. 발급된 토큰 정보에 대해서는 취소가 불가능하며, 토큰이 공격자에게 탈취된 경우에는 토큰이 만료될때까지 서버에 계속적으로 요청을 보낼 수 있다.

    - 이를 위해 만료 기간을 짧게하면 유저가 수시로 로그인 해야 한다.

    - 구현을 하다보면 token blacklist 를 관리하게 될 가능성이 있어, 결국 서버측 메모리 소모가 발생하게 된다.

    - XS 공격에 취약해 민감한 정보는 포함시키지 말아야 한다.

<br>
<br>

---

> 그림 및 내용 참조 <br> https://tansfil.tistory.com/58
